<template>
  <div class="my-10">
    <!-- show added task -->
    <div class="flex justify-items-start align-middle my-5">
      <h1
        class="p-2 underline-offset-8 underline decoration-yellow-600 text-gray-700 text-3xl font-light"
      >
        {{ item.title }}
      </h1>
      <div v-if="item.is_complete" class="text-4xl p-2">‚úÖ</div>
    </div>
    <!-- show Edit dialog -->
    <div>
      <button @click="toggleEdit()" class="p-4 px-5 hover:bg-stone-200">
        üñçÔ∏è
      </button>
      <!-- Show done/undone -->
      <button
        @click="toggleTask()"
        class="hover:bg-stone-200 rounded p-2 mx-5 text-cyan-800 font-light"
      >
        Done?
      </button>
      <!-- delete function -->
      <button
        @click="remove()"
        class="px-5 text-3xl hover:bg-stone-200 rounded p-2 mx-5"
      >
        üóëÔ∏è
      </button>
    </div>
    <div v-if="editDialog" class="justify-between">
      <input v-model="editTask" type="text" class="min-w-full p-4" />
      <button
        @click.prevent="edit()"
        class="hover:bg-stone-200 rounded p-3 text-cyan-800 font-semibold text-xl"
      >
        Save Edit
      </button>
      <p class="text-red-500 text-xs">{{ errorInput }}</p>
    </div>
  </div>
</template>

<script setup>
import { ref } from "vue";

// Error messages variables
let empty = ref(false); // for editing a task
let errorInput = ref(""); // error message variable

// Edit Task Variables
let editTask = ref(""); // value from edit dialog
let editDialog = ref(false); // initially hidden where the input field will go
let currentIndex = ref(""); // Used to pick only the selected task to be edited
let taskDone = true; // toggles boolean

// Definition of childFunctions that will be used on parent component
const emit = defineEmits([
  "childToggle",
  "childRemove",
  "childEdit",
  // "childToggleEdit",
]);

// Set up the content of the template as an array prop to be used on the parent
const props = defineProps(["item"]);

// Error Handling Funciton
function errorHandle() {
  errorInput.value = "Task field edit cannot be empty";
  empty.value = true;
}

// Show Edit Dialog
function toggleEdit() {
  editDialog.value = !editDialog.value;
  editTask.value = props.item.title;
}

// Toggle Done & Undone
function toggleTask() {
  emit("childToggle", props.item);
}

// Function to edit tasks with validation :)
function edit() {
  if (editTask.value === "") errorHandle();
  // this errorHandle function displays an error if editTaskvalue if empty
  else {
    empty.value = false; // hides error message just in case
    editDialog.value = false; // hides the container where editing value lives
    const editValues = {
      oldValue: props.item,
      newValue: editTask.value,
    };
    emit("childEdit", editValues);
    editTask.value = ""; // clears input field
  }
}
// //Error Handling Function
// function errorHandle() {
//   errorInput.value = "Task field edit cannot be empty";
//   empty.value = true;
// }--->NEEDS TO BE BEFORE EDIT FUNCTION

// Function to remove items
function remove() {
  emit("childRemove", props.item);
}

// Error Handling
</script>

<style></style>
